@section style {
    <link href="@Url.Content("~/Content/biblio.css?a=7")" rel="stylesheet">
}
@section Scripts {
    <script>

        //浏览器加载并处理了文档的所有HTML元素之后才会执行。
        $(document).ready(function () {

            // 设顶部菜单不固定
            $("#myheader").css("position", "absolute");

            //检查是否已经加载过了
            var o = $(".biblio");
            if (o.length > 0) {
                var recPath = $("#biblioPath").text();
                //alert(recPath);
                if (recPath != null && recPath != "") {
                    // 图书馆
                    var libId = getLibId();
                    var myhtml = getDetail(libId, recPath, o, "detail", "");
                }
            }
        });

        // 2016-6-17 jane 为了返回时记住展开项，expand函数由原来传一个对象，改为传一个id
        function expand(expId) {
            //根据id找到<li>元素
            var id = "#" + expId;
            var obj = $(id);

            //alert(id);
            //alert(obj);

            // 如果自己是展开状态，则收缩
            var state = $(obj).find(".mui-collapse-content").first().css("display");
            if (state == "block") { //自己本来是展开状态，要关闭
                $(obj).find(".mui-collapse-content").css("display", "none");
                $(obj).removeClass("mui-active");
                // alert("1");
            }
            else {
                //其它收缩
                //$(".mui-collapse-content").css("display", "none");
                //$(".mui-collapse").removeClass("mui-active");

                //自己展开
                $(obj).find(".mui-collapse-content").css("display", "block");
                $(obj).addClass("mui-active");

                //alert("2");
            }
        }

        function saveItem() {

           // alert("1");

            var barcode = $("#barcode").val();
            if (barcode == "") {
                alert("您尚未输入册条码。");
                return;
            }

            var location = $("#location").val();
            if (location == "") {
                alert("您尚未输入馆藏地。");
                return;
            }

            var bookType = $("#bookType").val();
            if (bookType == "") {
                alert("您尚未输入册类型。");
                return;
            }
            //alert("bookType=[" + bookType + "]");

            var accessNo = $("#accessNo").val();
            if (accessNo == "") {
                alert("您尚未输入册条码。");
                return;
            }

            var price = $("#price").val();
            if (price == "") {
                alert("您尚未输入册价格。");
                return;
            }


            var batchNo = $("#batchNo").val();
            if (batchNo == "") {
                alert("您尚未输入批次号。");
                return;
            }

            //显示等待图层
            //var index = loadLayer();
            showMaskLayer();

            var url = "";
            var actionType = "";
            var id = "";
            if (id == null || id == "") {
                actionType = "POST";
                url = "/api/BiblioApi";
            }
            else {
                actionType = "PUT";
                url = "/api/BiblioApi?id=" + id;
            }
            //alert("id=["+id+"]");


            sendAjaxRequest(url, actionType,
                function (result) {

                    // 关闭等待层
                    //layer.close(index);
                    hideMaskLayer();

                    if (result.errorCode == -1) {
                        alert("保存出错:" + result.errorInfo);
                        return;
                    }

                    alert("保存成功。");

                    //model.librarys.push(newItem);
                    model.displaySummary(true);
                    getAllLib();

                    //清空编辑界面信息
                    clearEditModel();

                },
                function (xhq, textStatus, errorThrown) {
                    // 关闭等待层
                    layer.close(index);
                    hideMaskLayer();

                    alert(errorThrown);

                },
                {
                    //id: id,
                    barcode: barcode,
                    location: location,
                    bookType: bookType,
                    accessNo: accessNo,
                    price: price,
                    batchNo: batchNo
                }
            );

        }

    </script>
}

@section header {
    <h1 class="mui-title">书目信息</h1>
}
<span id="weixinId" style="display:none;">@ViewBag.weixinId</span>
<span id="patronBarcode" style="display:none">@ViewBag.PatronBarcode</span>
<span id="biblioPath" style="display:none;">@ViewBag.BiblioPath</span>
<!--当前是馆员帐户，出现册登记按钮，注意这里用_worker1-->
<span id="_worker1" style="display:none">@ViewBag.Worker</span>

@if (String.IsNullOrEmpty(ViewBag.Error) == false)
{
    <div class="mui-content-padded">
        <span class="errorinfo">
            @Html.Raw(ViewBag.Error)
        </span>
    </div>
}
else
{

    <li class='mui-table-view-cell mui-collapse' id='d1'>
        <a class='mui-navigate-right' href='javascript:void(0)' onclick="expand('d1')" style='padding-top:5px;padding-bottom:5px'>
            <table width='100%' class='result-biblio'>
                <tr>
                    <td style='color:#cccccc;width:77px'>@ViewBag.BiblioPath</td>
                    <td style='padding-right:10px;'><div id="_biblioName" style='width:100%; white-space:nowrap;overflow:hidden;text-overflow:ellipsis; '>@ViewBag.BiblioName</div></td>
                </tr>
            </table>
        </a>
        <div class='mui-collapse-content' style='display:block;padding-top: 0px;'>
            <div style="padding:10px">
                <div class='biblio'>
                </div>
            </div>
        </div>
    </li>

    <div class="mui-input-group" style="padding:10px">
        <div class="mui-input-row ">
            <label style="color:#cccccc">册条码</label>
            <input id='barcode' type="text" class="mui-input mui-input-clear" value="" placeholder="请输入 册条码">
        </div>
        <div class="mui-input-row ">
            <label style="color:#cccccc">馆藏地</label>
            <input id='location' type="text" class="mui-input mui-input-clear" value="" placeholder="请输入 馆藏地">
        </div>
        <div class="mui-input-row ">
            <label style="color:#cccccc">册类型</label>
            <input id='bookType' type="text" class="mui-input mui-input-clear" value=""  placeholder="请输入 册类型">
        </div>
        <div class="mui-input-row ">
            <label style="color:#cccccc">索取号</label>
            <input id='accessNo' type="text" class="mui-input mui-input-clear" value="" placeholder="请输入 索取号">
        </div>
        <div class="mui-input-row ">
            <label style="color:#cccccc">册价格</label>
            <input id='price' type="text" class="mui-input mui-input-clear" value="" placeholder="请输入 册价格">
        </div>
        <div class="mui-input-row ">
            <label style="color:#cccccc">批次号</label>
            <input id='batchNo' type="text" class="mui-input mui-input-clear" value="" placeholder="请输入 批次号">
        </div>
        <div class="mui-content-padded">
            <button id='btn' class="mui-btn mui-btn-block mui-btn-primary" onclick="saveItem()">保存</button>
        </div>
    </div>
}

